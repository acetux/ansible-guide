================
ROLE ICINGA2_WEB
================

.. image:: https://img.shields.io/github/license/adfinis-sygroup/ansible-role-icinga2_web.svg?style=flat-square
  :target: https://github.com/adfinis-sygroup/ansible-role-icinga2_web/blob/master/LICENSE

.. image:: https://img.shields.io/travis/adfinis-sygroup/ansible-role-icinga2_web.svg?style=flat-square
  :target: https://travis-ci.org/adfinis-sygroup/ansible-role-icinga2_web

.. image:: https://img.shields.io/badge/galaxy-adfinis--sygroup.icinga2_web-660198.svg?style=flat-square
  :target: https://galaxy.ansible.com/adfinis-sygroup/icinga2_web

This role installs and configures icingaweb2.


Requirements
=============

What you will need to benefit from this role a webserver installed on the system.
At Adfinis, we use the following role:

* `adfinis-sygroup.nginx <https://galaxy.ansible.com/adfinis-sygroup/nginx>`_



Role Variables
===============

.. code-block:: yaml

  # The icingaweb2 web ui password
  icinga2_web_admin_pass: 'passw0rd'
  
  # icinga2 API host
  icinga2_web_api_host: 127.0.0.1
  
  # icinga2 API port
  icinga2_web_api_port: 5665
  
  # icinga2 API user
  icinga2_web_api_user: icingaweb2
  
  # icinga2 API password
  icinga2_web_api_pass: 'passw0rd'
  
  
  ## icingaweb2 database settings
  # The icingaweb2 database name
  icinga2_web_icingaweb2_database_name: icingaweb2
  
  # The icingaweb2 database user
  icinga2_web_icingaweb2_database_user: icingaweb2
  
  # The icingaweb2 database password
  icinga2_web_icingaweb2_database_pass: 'passw0rd'
  
  # The icingaweb2 database host
  icinga2_web_icingaweb2_database_host: 127.0.0.1
  
  # The icingaweb2 database port
  icinga2_web_icingaweb2_database_port: 3306
  
  
  ## Icinga2 database settings
  # icinga2 database name
  icinga2_web_icinga2_database_name: icinga2
  #
  # icinga2 database host
  icinga2_web_icinga2_database_host: 127.0.0.1
  
  # icinga2 database port
  icinga2_web_icinga2_database_port: 3306
  
  # icinga2 database user
  icinga2_web_icinga2_database_user: icinga2
  
  # icinga2 database password
  icinga2_web_icinga2_database_pass: 'passw0rd'


LDAP Authentication
-------------------

To configure LDAP authentication, the following variables MUST be configured.
It is possible to enable multiple configuration backends.

.. code-block:: yaml

  # Icingaweb2 LDAP authentication
  # For further information, consult the official icingaweb2 documentation at
  # https://icinga.com/docs/icingaweb2/latest/doc/04-Resources/#ldap
  #icinga2_web_ldap:
  #  - name: res_ldap_example_com
  #    host: ldap.example.com
  #    port: 636
  #    encryption: ldaps
  #    root_dn: 'cn=accounts,dc=ldap,dc=example,dc=com'
  #    bind_dn: 'uid=icingaweb2.auth,cn=systems,dc=ldap,dc=example,dc=com'
  #    bind_pw: 'ldap password'
  #    timeout: 5


.. code-block:: yaml

  # Icingaweb2 LDAP User configuration
  # For further information, consult the official icingaweb2 documentation at
  # https://icinga.com/docs/icingaweb2/latest/doc/05-Authentication/#ldap
  #
  #icinga2_web_ldap_userconf:
  #  - name: user_ldap_example_com # required
  #    resource: 'res_ldap_example_com' # required
  #    user_class: 'inetOrgPerson' # required
  #    user_name_attribute: 'uid' # required
  #    base_dn: 'cn=accounts,dc=ldap,dc=example,dc=com' # optional
  #    filter: "(somefilter)" # optional
  
  icinga2_web_ldap_userconf: []


.. code-block:: yaml

  # Icingaweb2 LDAP Group configuration
  # For further information, consult the official icingaweb2 documentation at
  # https://icinga.com/docs/icingaweb2/latest/doc/05-Authentication/#ldap-groups
  #
  #icinga2_web_ldap_groupconf:
  #  - name: group_ldap_example_com # required
  #    resource: 'res_ldap_example_com' # required
  #    user_backend = "user_ldap_examle_com" # required
  #    user_class: 'user' # optional
  #    user_name_attribute: 'uid' # optional
  #    group_class: 'group' # optional
  #    group_name_attribute: 'gid' # optional
  #    group_member_attribute: 'memberUid' # optional
  #    group_filter: '(somefilter)' # optional


Icingaweb2 permissions
----------------------

.. code-block:: yaml

  # Icinga2 Permissions configuration
  # For further information, consult the official icingaweb2 documentation at
  # https://icinga.com/docs/icingaweb2/latest/doc/06-Security/#configuration
  #
  #icinga2_web_permissions:
  #  - name: Administrators
  #    users:
  #      - admin
  #    groups:
  #      - Administrators
  #    permissions:
  #      '*'
  #    object_filter: ""
  #  - name: customer
  #    users:
  #      - customer1
  #    permissions:
  #      'monitoring/command/*,module/*'
  #    object_filter: 'host_name=*.customer.example.com"'


Dependencies
=============

This role depends on the following roles:

* `adfinis-sygroup.php_fpm <https://galaxy.ansible.com/adfinis-sygroup/php_fpm>`_
* `adfinis-sygroup.icinga2_master <https://galaxy.ansible.com/adfinis-sygroup/icinga2_master>`_


Example Playbook
=================

.. code-block:: yaml

  - hosts: servers
    roles:
       - { role: adfinis-sygroup.icinga2_web }


License
========

`GPL-3.0 <https://github.com/adfinis-sygroup/ansible-role-icinga2_web/blob/master/LICENSE>`_


Author Information
===================

icinga2_web role was written by:

* Adfinis SyGroup AG | `Website <https://www.adfinis-sygroup.ch/>`_ | `Twitter <https://twitter.com/adfinissygroup>`_ | `GitHub <https://github.com/adfinis-sygroup>`_


Default values
==============

   
The icingaweb2 web ui password

.. code-block:: YAML

   icinga2_web_admin_pass: 'passw0rd'
   
icinga2 API host

.. code-block:: YAML

   icinga2_web_api_host: 127.0.0.1
   
icinga2 API port

.. code-block:: YAML

   icinga2_web_api_port: 5665
   
icinga2 API user

.. code-block:: YAML

   icinga2_web_api_user: icingaweb2
   
icinga2 API password

.. code-block:: YAML

   icinga2_web_api_pass: 'passw0rd'
   
icinga2 director API host

.. code-block:: YAML

   icinga2_web_director_api_host: 127.0.0.1
   
icinga2 director API port

.. code-block:: YAML

   icinga2_web_director_api_port: 5665
   
icinga2 director API user

.. code-block:: YAML

   icinga2_web_director_api_user: director
   
icinga2 director API password

.. code-block:: YAML

   icinga2_web_director_api_pass: 'passw0rd'
   
# icingaweb2 database settings
The icingaweb2 database name

.. code-block:: YAML

   icinga2_web_icingaweb2_database_name: icingaweb2
   
The icingaweb2 database user

.. code-block:: YAML

   icinga2_web_icingaweb2_database_user: icingaweb2
   
The icingaweb2 database password

.. code-block:: YAML

   icinga2_web_icingaweb2_database_pass: 'passw0rd'
   
The icingaweb2 database host

.. code-block:: YAML

   icinga2_web_icingaweb2_database_host: 127.0.0.1
   
The icingaweb2 database port

.. code-block:: YAML

   icinga2_web_icingaweb2_database_port: 3306
   
the hostpattern which can access and login with the icingaweb2 user

.. code-block:: YAML

   icinga2_web_icingaweb2_database_hostpattern: 'localhost'
   
icingaweb2 database ssl connection (1 or 0)

.. code-block:: YAML

   icinga2_web_icingaweb2_database_ssl: 0
   
icingaweb2 database ssl ca path

.. code-block:: YAML

   icinga2_web_icingaweb2_database_ssl_ca: /etc/pki/tls/certs/ca-bundle.crt
   
   
A root user on the db host with permissions to
add the user specified above (icinga2_web_icingaweb2_database_user)

.. code-block:: YAML

   icinga2_web_database_root_user: root
   
corresponding password to the root user

.. code-block:: YAML

   icinga2_web_database_root_pass: 'passw0rd'
   
   
# Icinga2 database settings
icinga2 database name

.. code-block:: YAML

   icinga2_web_icinga2_database_name: icinga2

icinga2 database host

.. code-block:: YAML

   icinga2_web_icinga2_database_host: 127.0.0.1
   
icinga2 database port

.. code-block:: YAML

   icinga2_web_icinga2_database_port: 3306
   
icinga2 database user

.. code-block:: YAML

   icinga2_web_icinga2_database_user: icinga2
   
icinga2 database password

.. code-block:: YAML

   icinga2_web_icinga2_database_pass: 'passw0rd'
   
icinga2 database ssl connection (1 or 0)

.. code-block:: YAML

   icinga2_web_icinga2_database_ssl: 0
   
icinga2 database ssl ca path

.. code-block:: YAML

   icinga2_web_icinga2_database_ssl_ca: /etc/pki/tls/certs/ca-bundle.crt
   
icingaweb2 managed config files

.. code-block:: YAML

   icinga2_web_managed_config_files:
     - config.ini
     - resources.ini
     - roles.ini
     - authentication.ini
     - groups.ini
   
   icinga2_web_modules: []
    #- name: graphite
    #  version: master
    #- name: ipl
    #  version: v0.5.0
    #- name: incubator
    #  version: v0.5.0
    #- name: reactbundle
    #  version: v0.7.0
    #- name: director
    #  version: v1.7.2
   
Icingaweb2 LDAP authentication
For further information, consult the official icingaweb2 documentation at
https://icinga.com/docs/icingaweb2/latest/doc/04-Resources/#ldap

icinga2_web_ldap:
 - name: res_ldap_example_com
   host: ldap.example.com
   port: 636
   encryption: ldaps
   root_dn: 'cn=accounts,dc=ldap,dc=example,dc=com'
   bind_dn: 'uid=icingaweb2.auth,cn=systems,dc=ldap,dc=example,dc=com'
   bind_pw: 'ldap password'
   timeout: 5

.. code-block:: YAML

   icinga2_web_ldap: []
   
Icingaweb2 LDAP User configuration
For further information, consult the official icingaweb2 documentation at
https://icinga.com/docs/icingaweb2/latest/doc/05-Authentication/#ldap

icinga2_web_ldap_userconf:
 - name: user_ldap_example_com # required
   resource: 'res_ldap_example_com' # required
   user_class: 'inetOrgPerson' # required
   user_name_attribute: 'uid' # required
   base_dn: 'cn=accounts,dc=ldap,dc=example,dc=com' # optional
   filter: "(somefilter)" # optional

.. code-block:: YAML

   icinga2_web_ldap_userconf: []
   
Icingaweb2 LDAP Group configuration
For further information, consult the official icingaweb2 documentation at
https://icinga.com/docs/icingaweb2/latest/doc/05-Authentication/#ldap-groups

icinga2_web_ldap_groupconf:
 - name: group_ldap_example_com # required
   resource: 'res_ldap_example_com' # required
   user_backend: 'user_ldap_examle_com' # required
   user_class: 'user' # optional
   user_name_attribute: 'uid' # optional
   group_class: 'group' # optional
   group_name_attribute: 'gid' # optional
   group_member_attribute: 'memberUid' # optional
   group_filter: '(somefilter)' # optional

.. code-block:: YAML

   icinga2_web_ldap_groupconf: []
   
Icingaweb2 database group configuration
For further information, consult the official icingaweb2 documentation at
https://icinga.com/docs/icinga-web-2/latest/doc/05-Authentication/#database-groups

icinga2_web_database_groupconf:
 - name: icingaweb2
   backend: db
   resource: icingaweb_db


.. code-block:: YAML

   icinga2_web_database_groupconf: []
   
Icinga2 Permissions configuration
For further information, consult the official icingaweb2 documentation at
https://icinga.com/docs/icingaweb2/latest/doc/06-Security/#configuration

icinga2_web_permissions:
 - name: Administrators
   users:
     - admin
   groups:
     - Administrators
   permissions:
     '*'
   object_filter: ""
 - name: customer
   users:
     - customer1
   permissions:
     'monitoring/command/*,module/*'
   object_filter: 'host_name=*.customer.example.com"'

.. code-block:: YAML

   icinga2_web_permissions:
     - name: Administrators
       users:
         - admin
       groups:
         - Administrators
       permissions:
        - '*'
   
Director Resources configuration
For further information, consult the official icingaweb2 documentation at
https://icinga.com/docs/director/latest/doc/03-Automation/
icinga2_web_director:
 - name: 'director_db'
   db: 'mysql'
   host: 'db.example.com'
   port: '3306'
   dbname: 'director'
   username: 'director@example.com'
   password: '3xample'
   charset: 'utf-8'
   use_ssl: '1'
   ssl_ca: '/etc/pki/tls/certs/ca-bundle.crt'

.. code-block:: YAML

   icinga2_web_director: []
   
Reporting resources configuration
icinga2_web_reporting:
 - name: 'reporting_db'
   db: 'mysql'
   host: 'db.example.com'
   port: '3306'
   dbname: 'reporting'
   username: 'reporting@example.com'
   password: '3xample'
   charset: 'utf8mb4'
   use_ssl: '1'
   ssl_ca: '/etc/pki/tls/certs/ca-bundle.crt'

.. code-block:: YAML

   icinga2_web_reporting: []
   
Grafana configuration

.. code-block:: YAML

   icinga2_web_grafana:
     enabled: false
     #domain: example.com
     #oidc:
       #enabled: true
       #config:
         #name: Example SSO
         #allow_sign_up: true
         #client_id: example-client
         #client_secret: example-secret
         #scopes: openid,email,profile
         #email_attribute_name: email
         #email_attribute_path: email
         #auth_url: https://sso.example.com/auth/realms/example/protocol/openid-connect/auth
         #token_url: https://sso.example.com/auth/realms/example/protocol/openid-connect/token
         #api_url: https://sso.example.com/auth/realms/example/protocol/openid-connect/userinfo
         #role_attribute_path: contains(groups[*], '/admin') && 'Admin'
